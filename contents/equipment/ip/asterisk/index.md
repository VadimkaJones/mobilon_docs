--- 
template: equipment.jade
title: 1
order: 10
---

## Настройка IP-PBX Asterisk
Разберем способ настройки IP-PBX Asterisk через конфигурационные файлы.

Для осуществления регистрации нужно отредактировать файл sip.conf. В контексте [general] нужно вписать следующую строчку:

register = login:password@sip.server:5060/extension

где:

login — это SIP Логин Вашей учетной записи

password — пароль от Вашей учетной записи SIP

sip.server — адрес SIP сервера, на который проходит регистрация

extension — это экстеншен, на который будут приходить входящие вызовы по данной четной записи. Он настраивается в файле extensions.conf

Теперь нужно добавить соответствующую учетную запись для этой регистрации на Вашем asterisk сервере, в том же файле sip.conf. В итоге файл sip.conf должен выглядеть примерно следующим образом:

[general]

register = login:password@sip.server:5060/extension

[login]

type = peer
host=sip.server
externalauth=yes
username=login
secret=password
fromuser=login
fromdomain=sip.server
nat=yes|no ; в зависимости от того, испльзуете ли вы NAT соединение
t38pt_udptl=yes|no ; в зависимости от того, используете ли вы протокол передачи факсимильных сообщений T.38
qualify=yes|no ; yes — означает периодическую отправку OPTIONS пакетов и возможность посмотреть статус регистрации через команду sip show peer
canreinvite =no
dtmfmode = rfc2833
context = incoming
disallow=all
allow=alaw,ulaw,g729

Обратите внимание на выделенные поля. Помимо уже названных ранее логина, пароля и сервера регистрации так же выделено такое поле как context = incoming. Это контекст в который будут посылаться все входящие звонки по данной учетной записи. Этот контекст должен быть описан в файле extensions.conf.

allow=alaw,ulaw,g729 — список разрешенных кодеков, по которым возможно установление соединения.

Настройка файла extensions.conf.

Содержание файла должно быть приблизительно следующим:

[incoming]

exten => extension,1,Dial()

[outgoing]

exten => _X.,1,Dial(SIP/login/${EXTEN})

где extension это тот номер, о котором говорилось в разделе настроек sip.conf. Контекст incoming при этом описывает дальнейшее поведение сервера при входящих звонках по данной учетной записи. Контекст outgoing представлен в качестве примера совершения исходящих вызовов по данной учетной записи. Обратите внимание, что шаблон _X. означает набор любого количества любых цифр.

Состояние регистрации учетной записи можно посмотреть внутренней командой asterisk сервера: sip show register
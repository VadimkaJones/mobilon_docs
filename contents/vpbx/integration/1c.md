--- 
template: vpbx.jade
title: Интеграция с 1С
order: 10
---


# Интеграция с 1С

1С может быть интегрирована с Виртуальной АТС Мобилон посредством веб-сервисов 1С. [Веб-сервисы 1С](http://v8.1c.ru/overview/Term_000000273.htm) реализуются на основе WSDL/SOAP интерфейса. 1С публикует список доступных методов и параметров, а внешняя система может их использовать. 

Для интеграции необходимо реализовать два метода: один для получения информации о звонящем (по номеру звонящего) и второй для отображения карточки клиента (по номеру звонящего).


## Получение информации о звонящем 

Происходит получение имени абонента из 1С БД по номеру звонящего.

Необходимо реализовать интерфейс веб-сервиса, который будет возвращать имя.

Пример запроса от Виртуальной АТС Мобилон (в секции number передается номер звонящего):

`````
curl -X POST -H "Content-Type: text/xml" \
     -H "Authorization: Basic U09BUDoxMjM=" \
     -H "Cache-Control: no-cache" \
     -d '<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
        <SayName xmlns="http://test">
            <number>89235292926</number>
        </SayName>
    </soap:Body>
</soap:Envelope>
' "http://<ваш ip>:8080/telephony/ws/VATS" 

`````

Пример ответа от веб-сервиса 1С:

`````
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
        <m:SayNameResponse xmlns:m="http://test">
            <m:return xmlns:xs="http://www.w3.org/2001/XMLSchema" 
                    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">VIP:Ренессанс Капитал</m:return>
        </m:SayNameResponse>
    </soap:Body>
</soap:Envelope>

`````

## Отображение карточки о звонящем

В интерфейсе 1С пользователя 1С появляется карточка абонента во время звонка.

Необходимо реализовать интерфейс веб-сервиса, который будет принимать данные во время звонка.

Пример запроса от Виртуальной АТС Мобилон (в секции number передается номер звонящего, в секции key - ключ абонента):

`````
curl -X POST -H "Authorization: Basic U09BUDoxMjM=" -H "Content-Type: text/xml" -H "Cache-Control: no-cache" -d '<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
        <IncomingCall xmlns="http://VATS">
            <NumFrom>89235292926</NumFrom>
            <Key>gW3cyUJAtl50PhF</Key>
        </IncomingCall>
    </soap:Body>
</soap:Envelope>
' "http://<ваш ip>/telephony/ws/VATS" 

`````

Пример ответа от веб-сервиса 1С:

`````
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
        <m:IncomingCallResponse xmlns:m="http://VATS">
            <m:return xmlns:xs="http://www.w3.org/2001/XMLSchema" 
                    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">1</m:return>
        </m:IncomingCallResponse>
    </soap:Body>
</soap:Envelope>

`````

[Инструкция](attachments/MobilonVATS-1C-integration.pdf) - здесь рассказано как реализовать появление карточки со стороны 1С.


*** Внимание. Указанные  выше примеры могут отличаться от используемых в реальных системах в зависимости от версий ПО и приведены с целью ознакомления. Пожалуйста, в случае вопросов свяжитесь с технической поддержкой Виртуальной АТС Мобилон.


